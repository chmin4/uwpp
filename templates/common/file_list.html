{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0"><strong>ğŸ“ ë‚´ íŒŒì¼ ëª©ë¡</strong></h2>
    <button class="btn btn-danger" onclick="window.close()" id="closeBtn">ë¹ ë¥¸ ë‹«ê¸°</button>
  </div>
<br>
  {% if files %}
    <ul class="list-group">
      {% for file in files %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <strong>{{ file.file.name|cut:"uploads/" }}</strong><br>
            <small class="text-muted">{{ file.uploaded_at|date:"Y-m-d H:i" }}</small>
          </div>
          <div>
            
            <a href="#" class="btn btn-sm btn-primary copy-url-btn" data-file-id="{{file.id}}">URLë³µì‚¬</a>
            <a href="{% url 'common:download_file' file.id %}" class="btn btn-sm btn-success">ë‹¤ìš´ë¡œë“œ</a>
            <a href="{% url 'common:delete_file' file.id %}" class="btn btn-sm btn-danger"
               onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">ì‚­ì œ</a>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">ì—…ë¡œë“œëœ íŒŒì¼ì´ ì—†ì–´ìš”</p>
  {% endif %}
  <div class="mt-3">
    <a href="{% url 'common:upload' %}" class="btn btn-primary">ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œí•˜ê¸°</a>
  </div>
</div>
<br>
<br>
<br>
<br>
<br>
<br>
<script>

 if (window.opener == null || window.opener === window) {
 document.getElementById("closeBtn").style.display = "none";
 }

document.addEventListener('click', function(e) {
    if (e.target.classList.contains('copy-url-btn')) {
        e.preventDefault();
        const fileId = e.target.dataset.fileId;
        copyUrlToClipboard(fileId);
    }
});

function copyUrlToClipboard(fileId) {
    const url = `/common/download/${fileId}`;
    navigator.clipboard.writeText(url)
        .catch(err => {
            alert("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + err);
        });
}
</script>


{% endblock %}
